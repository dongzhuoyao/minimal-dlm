# Default configuration for Minimal Masked Diffusion Model

# Run tag (used as wandb run name if set)
tag: null

# Hydra settings
hydra:
  job:
    chdir: false
  run:
    dir: outputs/${now:%Y-%m-%d}/${now:%H-%M-%S}

# Model architecture
model:
  n_layer: 4
  n_head: 4
  n_embd: 256
  block_size: 256
  dropout: 0.0
  bias: false

# Diffusion process
diffusion:
  # Method: 'mdm' (Masked Diffusion Model) or 'duo' (Discrete Uniform Diffusion)
  dynamic: mdm
  eps: 1e-3

  # dKV-Cache settings (only used when dynamic: mdm)
  # Reference: https://github.com/horseee/dKV-Cache (NeurIPS'25)
  use_dkv: false  # Enable dKV-Cache for faster inference
  cache_reloading_step: 1  # Reload cache every N steps (1=no caching, higher=faster but less accurate)

  # DUO-specific settings (only used when dynamic: duo)
  duo:
    gamma_min: -10.0
    gamma_max: 10.0
    curriculum_start: 0
    curriculum_end: 5000
    gumbel_tau_log10_start: 0.0
    gumbel_tau_log10_end: -10.0
    top_p: 1.0  # Nucleus sampling (1.0 = disabled)

# Training
training:
  batch_size: 256
  max_iters: 10000
  learning_rate: 1e-3
  weight_decay: 0.1
  warmup_iters: 500
  min_lr: 1e-4
  grad_clip: 1.0
  eval_interval: 250
  eval_iters: 20
  log_interval: 100
  save_interval: 1000

# Sampling
sampling:
  steps: 64
  temperature: 1.0
  strategy: stochastic  # stochastic or confidence

# Data
data:
  dir: data/shakespeare_char
  dataset: shakespeare_char

# Wandb (enabled by default)
wandb:
  enabled: true
  project: minimal-dlm
  entity: null
  name: null  # auto-generated from output dir if null

# System
system:
  device: cuda
  dtype: bfloat16
  seed: 42
  compile: false
